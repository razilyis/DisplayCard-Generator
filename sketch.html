<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DisplayCard - Product Sketch</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- „Éï„Ç©„É≥„Éà„ÅÆËøΩÂä†„É≠„Éº„Éâ: Êó•Êú¨Ë™ûÊâãÊõ∏„ÅçÈ¢®„Éï„Ç©„É≥„Éà„ÇíÂê´„ÇÄ -->
    <link
        href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;600&family=Teko:wght@300;400;600&family=Architects+Daughter&family=Yomogi&family=Kiwi+Maru:wght@300;500&family=Klee+One:wght@400;600&family=Yuji+Syuku&family=Kaisei+Decol&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --card-width: 91mm;
            --card-height: 55mm;
            --accent-color: #E63946;
            /* Marker Red */
            --paper-color: #Fdfdfd;
            --ink-color: #333333;
            --grid-color: #e0e0e0;
            --slogan-font: 'Architects Daughter', cursive;
        }

        body {
            background-color: #e5e5e5;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            font-family: 'Barlow', sans-serif;
            padding: 4rem 2rem;
        }

        .tool-container {
            width: 100%;
            max-width: var(--card-width);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #captureArea {
            padding: 0.5rem;
            background-color: transparent;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 1.5rem;
            width: 100%;
            overflow: hidden;
        }

        /* Desktop Layout Override */
        @media (min-width: 1024px) {
            .tool-container {
                max-width: 1600px;
                display: grid;
                grid-template-columns: 1fr 400px;
                grid-template-areas:
                    "preview filesystem"
                    "preview editor";
                gap: 2rem;
                align-items: start;
            }

            #captureArea {
                grid-area: preview;
                /* Allow JS to set height for scaled card */
                overflow: visible;
                position: sticky;
                top: 2rem;
                display: flex;
                justify-content: center;
                align-items: flex-start;
                padding-top: 2rem;
            }

            .file-system-panel {
                grid-area: filesystem;
                width: 100%;
            }

            .editor-panel {
                grid-area: editor;
                width: 100%;
            }
        }

        /* Sketch Card Style */
        .card {
            width: var(--card-width);
            height: var(--card-height);
            background-color: var(--paper-color);
            color: var(--ink-color);
            position: relative;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 6mm;
            box-sizing: border-box;
            border: 1px solid #ddd;
            -webkit-font-smoothing: antialiased;
            transform: translateZ(0);

            /* Grid Pattern */
            background-image:
                linear-gradient(var(--grid-color) 1px, transparent 1px),
                linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
            background-size: 5mm 5mm;
        }

        .font-condensed {
            font-family: 'Teko', sans-serif;
        }

        .font-hand {
            font-family: var(--slogan-font);
        }

        /* Variable Font */

        /* Dynamic Colors */
        .dynamic-text {
            color: var(--accent-color) !important;
        }

        .dynamic-bg {
            background-color: var(--accent-color) !important;
        }

        .dynamic-border {
            border-color: var(--accent-color) !important;
        }

        /* Editor Panel */
        .editor-panel {
            background: #fff;
            border-radius: 4px;
            padding: 1.5rem;
            border: 1px solid #ccc;
            width: 100%;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        /* Inputs */
        input[type="text"],
        textarea,
        select {
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            color: #333;
            font-family: 'Barlow', sans-serif;
            font-size: 11px;
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            border-color: #333;
            outline: none;
            background-color: #fff;
        }

        /* Image Upload Area */
        .image-upload-zone {
            border: 2px dashed #ddd;
            padding: 1rem;
            text-align: center;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            background: #fafafa;
        }

        .image-upload-zone:hover {
            border-color: var(--accent-color);
            background: #fff;
        }

        /* Swatches */
        .color-swatch-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 6px;
        }

        .color-dot {
            width: 100%;
            aspect-ratio: 1 / 1;
            border-radius: 2px;
            cursor: pointer;
            border: 1px solid #ddd;
            transition: all 0.2s;
        }

        .color-dot:hover {
            transform: scale(1.1);
            z-index: 10;
            border-color: #333;
        }

        .color-dot.active {
            border: 2px solid #333;
            box-shadow: 0 0 0 2px #fff inset;
        }

        /* Buttons */
        .btn-main {
            background-color: #333;
            color: white;
            border: none;
            font-family: 'Barlow', sans-serif;
            font-weight: bold;
            transition: all 0.2s;
        }

        .btn-main:hover {
            background-color: #000;
        }

        .btn-outline {
            background-color: transparent;
            border: 1px solid #333;
            color: #333;
            font-family: 'Barlow', sans-serif;
            font-weight: bold;
        }

        .btn-outline:hover {
            background-color: #eee;
        }

        .loader {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #333;
            border-radius: 50%;
            width: 14px;
            height: 14px;
            animation: spin 1s linear infinite;
            display: inline-block;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        #exportStatus {
            position: fixed;
            bottom: 20px;
            background: #333;
            color: #fff;
            padding: 8px 16px;
            border: 1px solid #fff;
            font-size: 12px;
            display: none;
            z-index: 1000;
        }

        /* Slider */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 4px;
            background: #ddd;
            border-radius: 2px;
            outline: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 12px;
            height: 12px;
            background: #333;
            border-radius: 50%;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div class="w-full max-w-3xl flex justify-between items-center mb-8 px-4 font-mono">
        <a href="index.html" class="text-xs font-bold text-gray-500 hover:text-gray-800 transition">&lt; MENU</a>
        <h1 class="text-xl font-bold text-gray-700 tracking-wider font-condensed uppercase">PRODUCT SKETCH</h1>
        <div class="w-16"></div>
    </div>

    <div class="tool-container space-y-4">

        <!-- File Save Section -->
        <div class="file-system-panel bg-white p-3 border border-gray-300 w-full shadow-sm">
            <label class="block text-[9px] font-bold text-gray-500 uppercase tracking-widest mb-2 font-mono">
                FILE SYSTEM
            </label>
            <div class="grid grid-cols-2 gap-2">
                <button id="exportJsonBtn" class="btn-outline text-[10px] py-2 flex items-center justify-center gap-1">
                    <span>SAVE CONFIG</span>
                </button>
                <button id="importJsonBtn" class="btn-outline text-[10px] py-2 flex items-center justify-center gap-1">
                    <span>LOAD CONFIG</span>
                </button>
                <input type="file" id="jsonFileInput" accept=".json" class="hidden">
            </div>
        </div>

        <!-- Card Preview Area -->
        <div id="captureArea">
            <div class="card" id="productCard">
                <!-- Decorative Top Bar -->
                <div class="absolute top-0 left-6 w-1.5 h-6 dynamic-bg"></div>

                <!-- Uploaded Image Container -->
                <div class="absolute inset-0 flex items-center justify-center overflow-hidden z-0">
                    <img id="displayImage" src="" alt="" class="opacity-90 grayscale contrast-125 mix-blend-multiply"
                        style="transform: scale(1) translate(0px, 0px); display: none;">
                    <!-- Placeholder if no image -->
                    <div id="imagePlaceholder"
                        class="text-gray-300 border-2 border-dashed border-gray-300 rounded-lg p-8 flex flex-col items-center">
                        <svg class="w-12 h-12 mb-2 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1"
                                d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z">
                            </path>
                        </svg>
                        <span class="text-[10px] font-mono uppercase tracking-widest">NO IMAGE DATA</span>
                    </div>
                </div>

                <!-- Content Overlay -->
                <div class="z-10 flex flex-col h-full justify-between relative pointer-events-none">

                    <!-- Header -->
                    <div class="flex justify-between items-start">
                        <div>
                            <h1
                                class="text-3xl font-condensed font-bold tracking-tight uppercase leading-none text-gray-800">
                                <span id="displayBrandName">AroundForty</span><span class="dynamic-text">.</span>
                            </h1>
                            <p class="text-[7px] font-mono text-gray-500 tracking-widest mt-1">PRODUCT SPECIFICATION
                                SHEET</p>
                        </div>
                        <div class="text-right">
                            <!-- Fixed REF NO Box Alignment -->
                            <div
                                class="border border-gray-800 px-3 py-1 inline-flex flex-col items-center justify-center bg-white/80 min-w-[40px] shadow-sm">
                                <span class="text-[5px] text-gray-500 uppercase leading-none mb-0.5 font-mono">REF
                                    NO.</span>
                                <span class="text-[10px] font-bold leading-none font-mono text-gray-900">A-001</span>
                            </div>
                        </div>
                    </div>

                    <!-- Middle Area (Mainly for image visibility) -->
                    <div class="flex-grow"></div>

                    <!-- Footer Info -->
                    <div class="flex items-end justify-between">

                        <!-- Left Block: Slogan -->
                        <div class="w-1/2 pr-4">
                            <div class="w-8 h-0.5 dynamic-bg mb-2"></div>
                            <div id="displaySlogan" class="text-[8pt] font-hand font-bold text-gray-600 leading-tight">
                                Designed for the mature mind.
                                Precision Engineered.
                            </div>
                        </div>

                        <!-- Right Block: Specs -->
                        <div class="w-1/2 flex flex-col gap-2 text-right">
                            <div class="bg-white/90 p-2 border-l-2 dynamic-border shadow-sm">
                                <div class="flex justify-between items-baseline border-b border-gray-200 pb-1 mb-1">
                                    <span class="text-[5px] text-gray-400 font-mono uppercase"
                                        id="displayCodeNameLabel">MODEL</span>
                                    <span class="text-[9px] font-bold font-condensed text-gray-800 tracking-wide"
                                        id="displayCodeName">AROUNDFORTYRB</span>
                                </div>
                                <div class="flex justify-between items-baseline mb-1">
                                    <span class="text-[5px] text-gray-400 font-mono uppercase"
                                        id="displayMfgCodeLabel">MFG. CODE</span>
                                    <span class="text-[8px] font-bold font-mono text-gray-700"
                                        id="displayMfgCode">02AFRB</span>
                                </div>
                                <div class="flex justify-between items-baseline">
                                    <span class="text-[5px] text-gray-400 font-mono uppercase"
                                        id="displayOwnerLabel">OWNER</span>
                                    <span class="text-[8px] font-bold font-mono text-gray-700"
                                        id="displayOwner">@USER</span>
                                </div>
                            </div>

                            <!-- Sub Specs -->
                            <div
                                class="flex justify-end gap-3 text-[6px] font-mono text-gray-500 bg-white/80 py-1 px-2 rounded-sm inline-flex self-end shadow-sm">
                                <div>
                                    <span class="block opacity-50" id="displayKeySwitchLabel">SWITCH</span>
                                    <span class="font-bold text-gray-800" id="displayKeySwitch">MX RED</span>
                                </div>
                                <div>
                                    <span class="block opacity-50" id="displayKeyCapsLabel">KEYCAPS</span>
                                    <span class="font-bold text-gray-800" id="displayKeyCaps">PBT DS</span>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <!-- Editor Panel -->
        <div class="editor-panel">
            <div class="flex justify-between items-center mb-6 border-b border-gray-200 pb-4">
                <h2 class="text-xs font-bold text-gray-500 flex items-center gap-2">>> EDIT PARAMETERS</h2>
            </div>

            <div class="space-y-5">
                <!-- Image Upload & Controls -->
                <div>
                    <label
                        class="block text-[9px] font-bold text-gray-500 uppercase tracking-widest mb-2 font-mono">PRODUCT
                        IMAGE (LINE ART)</label>
                    <label class="image-upload-zone block mb-3">
                        <span class="text-xs text-gray-500 font-bold pointer-events-none">üìÅ CLICK TO UPLOAD
                            IMAGE</span>
                        <input type="file" id="imageUpload" accept="image/*" class="hidden">
                    </label>

                    <div class="grid grid-cols-3 gap-2 mb-2">
                        <div>
                            <label class="text-[8px] font-bold text-gray-400 uppercase">POS X</label>
                            <input type="range" id="imgPosX" min="-200" max="200" value="0" class="w-full">
                        </div>
                        <div>
                            <label class="text-[8px] font-bold text-gray-400 uppercase">POS Y</label>
                            <input type="range" id="imgPosY" min="-200" max="200" value="0" class="w-full">
                        </div>
                        <div>
                            <label class="text-[8px] font-bold text-gray-400 uppercase">SCALE</label>
                            <input type="range" id="imgScale" min="0.1" max="3.0" step="0.1" value="1.0" class="w-full">
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="imgMultiply" checked
                            class="rounded border-gray-300 text-black focus:ring-black">
                        <label for="imgMultiply"
                            class="text-[9px] font-bold text-gray-500 uppercase cursor-pointer">MULTIPLY MODE
                            (BLEND)</label>
                    </div>
                </div>

                <hr class="border-gray-200">

                <!-- Colors -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label
                            class="block text-[9px] font-bold text-gray-500 uppercase tracking-widest font-mono">MARKER
                            COLOR</label>
                    </div>
                    <div class="color-swatch-grid" id="swatchGrid"></div>
                </div>

                <!-- Text Inputs -->
                <div class="space-y-4">
                    <div>
                        <label
                            class="block text-[9px] font-bold text-gray-500 uppercase tracking-widest mb-1 font-mono">BRAND
                            NAME</label>
                        <input type="text" id="brandNameInput" value="AroundForty" class="w-full text-xs p-2">
                    </div>

                    <div>
                        <label
                            class="block text-[9px] font-bold text-gray-500 uppercase tracking-widest mb-1 font-mono">SLOGAN
                            (HANDWRITTEN)</label>
                        <textarea id="sloganInput" class="w-full text-xs p-2 h-12 mb-2 font-hand">Designed for the mature mind.
Precision Engineered.</textarea>

                        <div class="grid grid-cols-2 gap-2 mb-1">
                            <div>
                                <label
                                    class="text-[7px] font-bold text-gray-500 uppercase tracking-widest font-mono">FONT
                                    SIZE</label>
                                <div class="flex items-center gap-2">
                                    <input type="range" id="sloganSizeInput" min="4" max="24" value="8" step="0.5"
                                        class="flex-grow">
                                    <span id="sloganSizeDisplay"
                                        class="text-[8px] font-mono text-gray-500 w-6 text-right">8pt</span>
                                </div>
                            </div>
                            <div>
                                <label
                                    class="text-[7px] font-bold text-gray-500 uppercase tracking-widest font-mono">FONT
                                    FAMILY</label>
                                <select id="sloganFontSelect"
                                    class="w-full text-[10px] p-1 h-6 border border-gray-300 bg-white font-mono cursor-pointer">
                                    <option value="'Architects Daughter', cursive">ARCHITECTS (ENG)</option>
                                    <option value="'Yomogi', cursive">YOMOGI (JP)</option>
                                    <option value="'Kiwi Maru', serif">KIWI MARU (JP)</option>
                                    <option value="'Klee One', cursive">KLEE ONE (JP)</option>
                                    <option value="'Yuji Syuku', serif">YUJI SYUKU (JP)</option>
                                    <option value="'Kaisei Decol', serif">KAISEI DECOL (JP)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label
                                class="block text-[8px] font-bold text-gray-500 uppercase tracking-widest mb-1 font-mono">LABEL
                                1</label>
                            <input type="text" id="codeNameLabelInput" value="MODEL"
                                class="w-full text-[10px] p-1 mb-1 font-mono bg-white border border-gray-300 text-gray-400 uppercase">
                            <input type="text" id="codeNameInput" value="AROUNDFORTYRB"
                                class="w-full text-xs p-2 font-condensed tracking-wide uppercase">
                        </div>
                        <div>
                            <label
                                class="block text-[8px] font-bold text-gray-500 uppercase tracking-widest mb-1 font-mono">LABEL
                                2</label>
                            <input type="text" id="mfgCodeLabelInput" value="MFG. CODE"
                                class="w-full text-[10px] p-1 mb-1 font-mono bg-white border border-gray-300 text-gray-400 uppercase">
                            <input type="text" id="mfgCodeInput" value="02AFRB"
                                class="w-full text-xs p-2 font-mono uppercase">
                        </div>
                        <div>
                            <label
                                class="block text-[8px] font-bold text-gray-500 uppercase tracking-widest mb-1 font-mono">LABEL
                                3</label>
                            <input type="text" id="ownerLabelInput" value="OWNER"
                                class="w-full text-[10px] p-1 mb-1 font-mono bg-white border border-gray-300 text-gray-400 uppercase">
                            <input type="text" id="ownerInput" value="@USER" class="w-full text-xs p-2 font-mono">
                        </div>
                        <!-- Switch -->
                        <div>
                            <label
                                class="block text-[8px] font-bold text-gray-500 uppercase tracking-widest mb-1 font-mono">LABEL
                                4</label>
                            <input type="text" id="keySwitchLabelInput" value="SWITCH"
                                class="w-full text-[10px] p-1 mb-1 font-mono bg-white border border-gray-300 text-gray-400 uppercase">
                            <input type="text" id="keySwitchInput" value="MX RED" class="w-full text-xs p-2 font-mono">
                        </div>
                        <!-- Keycaps -->
                        <div>
                            <label
                                class="block text-[8px] font-bold text-gray-500 uppercase tracking-widest mb-1 font-mono">LABEL
                                5</label>
                            <input type="text" id="keyCapsLabelInput" value="KEYCAPS"
                                class="w-full text-[10px] p-1 mb-1 font-mono bg-white border border-gray-300 text-gray-400 uppercase">
                            <input type="text" id="keyCapsInput" value="PBT DS" class="w-full text-xs p-2 font-mono">
                        </div>
                    </div>
                </div>
            </div>

            <div class="pt-6 border-t border-gray-200 mt-6">
                <button id="btnExport"
                    class="w-full py-4 px-4 btn-main text-xs tracking-widest flex items-center justify-center gap-2 rounded">
                    <span>GENERATE IMAGE</span>
                </button>
            </div>
        </div>
    </div>

    <div id="exportStatus"></div>

    <script type="text/javascript">
        // Marker Colors
        const sketchSwatches = [
            { hex: "#E63946", label: "RED" },
            { hex: "#457B9D", label: "BLUE" },
            { hex: "#2A9D8F", label: "TEAL" },
            { hex: "#E9C46A", label: "YELLOW" },
            { hex: "#F4A261", label: "ORANGE" },
            { hex: "#333333", label: "BLACK" }
        ];

        const els = {
            card: document.getElementById('productCard'),
            // UI Elements
            brandName: document.getElementById('displayBrandName'),
            slogan: document.getElementById('displaySlogan'),

            codeNameLabel: document.getElementById('displayCodeNameLabel'),
            codeName: document.getElementById('displayCodeName'),
            mfgCodeLabel: document.getElementById('displayMfgCodeLabel'),
            mfgCode: document.getElementById('displayMfgCode'),
            ownerLabel: document.getElementById('displayOwnerLabel'),
            owner: document.getElementById('displayOwner'),
            keySwitchLabel: document.getElementById('displayKeySwitchLabel'),
            keySwitch: document.getElementById('displayKeySwitch'),
            keyCapsLabel: document.getElementById('displayKeyCapsLabel'),
            keyCaps: document.getElementById('displayKeyCaps'),

            // Image
            displayImage: document.getElementById('displayImage'),
            imagePlaceholder: document.getElementById('imagePlaceholder'),
            imageUpload: document.getElementById('imageUpload'),
            imgPosX: document.getElementById('imgPosX'),
            imgPosY: document.getElementById('imgPosY'),
            imgScale: document.getElementById('imgScale'),
            imgMultiply: document.getElementById('imgMultiply'),

            // Inputs
            brandNameInput: document.getElementById('brandNameInput'),
            sloganInput: document.getElementById('sloganInput'),
            sloganSizeInput: document.getElementById('sloganSizeInput'),
            sloganSizeDisplay: document.getElementById('sloganSizeDisplay'),
            sloganFontSelect: document.getElementById('sloganFontSelect'), // New

            codeNameLabelInput: document.getElementById('codeNameLabelInput'),
            codeNameInput: document.getElementById('codeNameInput'),
            mfgCodeLabelInput: document.getElementById('mfgCodeLabelInput'),
            mfgCodeInput: document.getElementById('mfgCodeInput'),
            ownerLabelInput: document.getElementById('ownerLabelInput'),
            ownerInput: document.getElementById('ownerInput'),
            keySwitchLabelInput: document.getElementById('keySwitchLabelInput'),
            keySwitchInput: document.getElementById('keySwitchInput'),
            keyCapsLabelInput: document.getElementById('keyCapsLabelInput'),
            keyCapsInput: document.getElementById('keyCapsInput'),

            btnExport: document.getElementById('btnExport'),
            status: document.getElementById('exportStatus'),
            exportJsonBtn: document.getElementById('exportJsonBtn'),
            importJsonBtn: document.getElementById('importJsonBtn'),
            jsonFileInput: document.getElementById('jsonFileInput'),
            swatchGrid: document.getElementById('swatchGrid')
        };

        const showStatus = (msg, duration = 3000) => {
            els.status.innerText = `>> ${msg}`;
            els.status.style.display = 'block';
            setTimeout(() => els.status.style.display = 'none', duration);
        };

        // Image Handling
        els.imageUpload.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (event) => {
                    els.displayImage.src = event.target.result;
                    els.displayImage.style.display = 'block';
                    els.imagePlaceholder.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        });

        // Image Transform Sync
        const syncImageTransform = () => {
            const x = els.imgPosX.value;
            const y = els.imgPosY.value;
            const s = els.imgScale.value;
            els.displayImage.style.transform = `translate(${x}px, ${y}px) scale(${s})`;

            if (els.imgMultiply.checked) {
                els.displayImage.classList.add('mix-blend-multiply');
            } else {
                els.displayImage.classList.remove('mix-blend-multiply');
            }
        };

        [els.imgPosX, els.imgPosY, els.imgScale, els.imgMultiply].forEach(el => {
            el.addEventListener('input', syncImageTransform);
        });

        // Text Sync
        const syncUI = () => {
            if (els.brandName) els.brandName.innerText = els.brandNameInput.value;
            if (els.slogan) els.slogan.innerText = els.sloganInput.value;

            // Slogan Font Size
            const sloganSize = els.sloganSizeInput.value;
            if (els.slogan) els.slogan.style.fontSize = `${sloganSize}pt`;
            if (els.sloganSizeDisplay) els.sloganSizeDisplay.innerText = `${sloganSize}pt`;

            if (els.codeNameLabel) els.codeNameLabel.innerText = els.codeNameLabelInput.value;
            if (els.codeName) els.codeName.innerText = els.codeNameInput.value.toUpperCase();

            if (els.mfgCodeLabel) els.mfgCodeLabel.innerText = els.mfgCodeLabelInput.value;
            if (els.mfgCode) els.mfgCode.innerText = els.mfgCodeInput.value.toUpperCase();

            if (els.ownerLabel) els.ownerLabel.innerText = els.ownerLabelInput.value;
            if (els.owner) els.owner.innerText = els.ownerInput.value;

            if (els.keySwitchLabel) els.keySwitchLabel.innerText = els.keySwitchLabelInput.value;
            if (els.keySwitch) els.keySwitch.innerText = els.keySwitchInput.value.toUpperCase();

            if (els.keyCapsLabel) els.keyCapsLabel.innerText = els.keyCapsLabelInput.value;
            if (els.keyCaps) els.keyCaps.innerText = els.keyCapsInput.value.toUpperCase();
        };

        // Font Change Listener
        els.sloganFontSelect.onchange = (e) => {
            document.documentElement.style.setProperty('--slogan-font', e.target.value);
        };

        [
            els.brandNameInput, els.sloganInput, els.sloganSizeInput,
            els.codeNameLabelInput, els.codeNameInput,
            els.mfgCodeLabelInput, els.mfgCodeInput,
            els.ownerLabelInput, els.ownerInput,
            els.keySwitchLabelInput, els.keySwitchInput,
            els.keyCapsLabelInput, els.keyCapsInput
        ].forEach(el => {
            if (el) el.addEventListener('input', syncUI);
        });

        // Theme Logic
        let currentAccentColor = "#E63946";
        const updateTheme = (hex) => {
            currentAccentColor = hex;
            document.documentElement.style.setProperty('--accent-color', hex);
            document.querySelectorAll('.color-dot').forEach(dot => {
                dot.classList.toggle('active', dot.dataset.hex === hex);
            });
        };

        const initSwatches = () => {
            els.swatchGrid.innerHTML = "";
            sketchSwatches.forEach(swatch => {
                const dot = document.createElement('div');
                dot.className = 'color-dot';
                dot.style.backgroundColor = swatch.hex;
                dot.dataset.hex = swatch.hex;
                dot.title = swatch.label;
                dot.onclick = () => updateTheme(swatch.hex);
                if (swatch.hex.toLowerCase() === currentAccentColor.toLowerCase()) { dot.classList.add('active'); }
                els.swatchGrid.appendChild(dot);
            });
        };

        function getFileName(extension) {
            const base = els.codeNameInput.value.trim() || "Sketch";
            const now = new Date();
            const timestamp = now.toISOString().replace(/[:.]/g, '-').slice(0, 19);
            return `SKETCH_${base}_${timestamp}.${extension}`;
        }

        els.exportJsonBtn.onclick = () => {
            const data = {
                brandName: els.brandNameInput.value,
                slogan: els.sloganInput.value,
                sloganSize: els.sloganSizeInput.value,
                sloganFont: els.sloganFontSelect.value, // Added
                codeNameLabel: els.codeNameLabelInput.value, codeName: els.codeNameInput.value,
                mfgCodeLabel: els.mfgCodeLabelInput.value, mfgCode: els.mfgCodeInput.value,
                ownerLabel: els.ownerLabelInput.value, owner: els.ownerInput.value,
                keySwitchLabel: els.keySwitchLabelInput.value, keySwitch: els.keySwitchInput.value,
                keyCapsLabel: els.keyCapsLabelInput.value, keyCaps: els.keyCapsInput.value,
                accentColor: currentAccentColor,
                imgX: els.imgPosX.value, imgY: els.imgPosY.value, imgS: els.imgScale.value,
                imgM: els.imgMultiply.checked,
                exportedAt: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = getFileName('json');
            link.click();
            URL.revokeObjectURL(url);
            showStatus("CONFIG SAVED");
        };

        els.importJsonBtn.onclick = () => els.jsonFileInput.click();
        els.jsonFileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    applyData(data);
                    showStatus("CONFIG LOADED (PLEASE RE-UPLOAD IMAGE)");
                } catch (err) { showStatus("LOAD FAILED"); }
            };
            reader.readAsText(file);
            e.target.value = '';
        };

        function applyData(data) {
            if (data.brandName) els.brandNameInput.value = data.brandName;
            if (data.slogan) els.sloganInput.value = data.slogan;
            if (data.sloganSize) {
                els.sloganSizeInput.value = data.sloganSize;
                els.sloganSizeDisplay.innerText = data.sloganSize + "pt";
            }
            if (data.sloganFont) {
                els.sloganFontSelect.value = data.sloganFont;
                document.documentElement.style.setProperty('--slogan-font', data.sloganFont);
            }

            if (data.codeNameLabel) els.codeNameLabelInput.value = data.codeNameLabel;
            if (data.codeName) els.codeNameInput.value = data.codeName;

            if (data.mfgCodeLabel) els.mfgCodeLabelInput.value = data.mfgCodeLabel;
            if (data.mfgCode) els.mfgCodeInput.value = data.mfgCode;
            if (data.ownerLabel) els.ownerLabelInput.value = data.ownerLabel;
            if (data.owner) els.ownerInput.value = data.owner;
            if (data.keySwitchLabel) els.keySwitchLabelInput.value = data.keySwitchLabel;
            if (data.keySwitch) els.keySwitchInput.value = data.keySwitch;
            if (data.keyCapsLabel) els.keyCapsLabelInput.value = data.keyCapsLabel;
            if (data.keyCaps) els.keyCapsInput.value = data.keyCaps;

            if (data.imgX) els.imgPosX.value = data.imgX;
            if (data.imgY) els.imgPosY.value = data.imgY;
            if (data.imgS) els.imgScale.value = data.imgS;
            if (data.imgM !== undefined) els.imgMultiply.checked = data.imgM;

            if (data.accentColor) updateTheme(data.accentColor);

            syncUI();
            syncImageTransform();
        }

        els.btnExport.onclick = async () => {
            if (typeof html2canvas === 'undefined') return showStatus("INITIALIZING LIB...");
            els.btnExport.disabled = true;
            const originalText = els.btnExport.innerHTML;
            els.btnExport.innerHTML = '<span class="loader"></span> RENDERING...';

            try {
                if (document.fonts && document.fonts.ready) { await document.fonts.ready; }
                const cardRect = els.card.getBoundingClientRect();

                const options = {
                    scale: 6, useCORS: true, backgroundColor: "#fdfdfd",
                    width: cardRect.width, height: cardRect.height, scrollX: 0, scrollY: -window.scrollY,
                    onclone: (clonedDoc) => {
                        const c = clonedDoc.getElementById('productCard');
                        if (c) {
                            c.style.boxShadow = 'none'; c.style.transform = 'none';
                            c.style.overflow = 'hidden'; // Keep sketch clean
                        }
                    }
                };

                const canvas = await html2canvas(els.card, options);
                const dataUrl = canvas.toDataURL('image/png', 1.0);
                const link = document.createElement('a');
                link.download = getFileName('png');
                link.href = dataUrl;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showStatus("EXPORT COMPLETE");
            } catch (err) {
                console.error("Export failed:", err);
                showStatus("EXPORT FAILED");
            } finally {
                els.btnExport.disabled = false;
                els.btnExport.innerHTML = originalText;
            }
        };

        // Context: Responsive & Init
        function adjustCardScale() {
            const card = els.card;
            const container = document.getElementById('captureArea');
            const screenWidth = window.innerWidth;
            const cardWidth = 344;

            // „Ç≥„É≥„ÉÜ„Éä„ÅÆ„Éë„Éá„Ç£„É≥„Ç∞Á≠â„ÇíËÄÉÊÖÆ„Åó„ÅüÂà©Áî®ÂèØËÉΩÂπÖ
            const availableWidth = container.clientWidth - 32;
            const currentCardWidth = 344; // Base width

            // Â∏∏„Å´„Çπ„Ç±„Éº„É´Ë®àÁÆó„ÇíË°å„ÅÜÔºàÊã°Â§ß„ÉªÁ∏ÆÂ∞è‰∏°ÂØæÂøúÔºâ
            let scale = availableWidth / currentCardWidth;

            // „Åü„Å†„Åó„ÄÅ„É¢„Éê„Ç§„É´„Å™„Å©Áã≠„ÅÑÁîªÈù¢„Åß„ÅØÁ∏ÆÂ∞è„ÅÆ„Åø„ÄÅÂ∫É„ÅÑÁîªÈù¢„Åß„ÅØÊã°Â§ß„ÇÇË®±ÂèØ„Åô„Çã„Åå‰∏äÈôê„ÇíË®≠„Åë„Çã
            // „Åì„Åì„Åß„ÅØ„Ç∑„É≥„Éó„É´„Å´„ÄÅÂà©Áî®ÂèØËÉΩÂπÖ„Å´Âêà„Çè„Åõ„Å¶„Éï„Ç£„ÉÉ„Éà„Åï„Åõ„Çã
            // Êã°Â§ß„Åó„Åô„Åé„ÇíÈò≤„Åê„Åü„ÇÅÊúÄÂ§ß„Çπ„Ç±„Éº„É´„ÇíÂà∂ÈôêÔºà‰æã: 2.5ÂÄçÔºâ
            scale = Math.min(scale, 2.5);

            card.style.transform = `scale(${scale})`;
            card.style.transformOrigin = 'center top';

            // „Çπ„Ç±„Éº„É´Âæå„ÅÆÈ´ò„Åï„Çí„Ç≥„É≥„ÉÜ„Éä„Å´ÂèçÊò† (ÂΩ±„ÇÑ‰ΩôÁôΩ„ÅÆ„Åü„ÇÅ„Å´Â∞ë„Åó„Éê„ÉÉ„Éï„Ç°„ÇíËøΩÂä†)
            const height = (currentCardWidth * (55 / 91) * scale) + 50;
            container.style.height = `${height}px`;

            // „Éá„Çπ„ÇØ„Éà„ÉÉ„ÉóË°®Á§∫Ôºà„Ç∞„É™„ÉÉ„Éâ„É¨„Ç§„Ç¢„Ç¶„ÉàÔºâ„ÅÆÂ†¥Âêà„ÄÅmargin-bottom„ÅÆË™øÊï¥„ÅØ‰∏çË¶Å„Åæ„Åü„ÅØÂà•ÈÄîCSS„ÅßÂà∂Âæ°
            if (window.innerWidth < 1024) {
                container.style.marginBottom = '1.5rem';
            } else {
                container.style.marginBottom = '0';
            }
        }

        window.addEventListener('resize', adjustCardScale);
        window.addEventListener('load', adjustCardScale);
        document.fonts.ready.then(adjustCardScale);

        initSwatches();
        syncUI();
    </script>
</body>

</html>