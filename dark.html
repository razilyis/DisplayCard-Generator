<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DisplayCard Generator [DARK]</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;800&family=Rajdhani:wght@500;700&family=Oswald:wght@400;700&family=Teko:wght@400;700&family=Share+Tech+Mono&family=Orbitron:wght@400;700&family=Chakra+Petch:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --card-width: 91mm;
            --card-height: 55mm;
            --accent-color: #00E5FF;
            --bg-color: #0F0F11;
            --text-main: #E0E0E0;
            --grid-color: rgba(255, 255, 255, 0.1);
            --main-font: 'JetBrains Mono', monospace;
        }
        
        body {
            background-color: #1a1a1a;
            color: #ccc;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            margin: 0;
            font-family: 'Inter', sans-serif;
            padding: 4rem 2rem;
        }
        
        .tool-container { width: var(--card-width); display: flex; flex-direction: column; align-items: center; }
        #captureArea { padding: 0; background-color: transparent; display: flex; justify-content: center; align-items: center; margin-bottom: 1.5rem; width: 100%; }

        .card {
            width: var(--card-width); height: var(--card-height); background-color: var(--bg-color); color: var(--text-main); position: relative; overflow: hidden;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); display: flex; flex-direction: column; justify-content: space-between; padding: 6mm; box-sizing: border-box; border: 1px solid #333;
            -webkit-font-smoothing: antialiased; transform: translateZ(0);
            background-image: linear-gradient(var(--grid-color) 1px, transparent 1px), linear-gradient(90deg, var(--grid-color) 1px, transparent 1px); background-size: 10mm 10mm;
            font-family: var(--main-font); /* フォント変数適用 */
        }

        .font-tech { font-family: var(--main-font); } /* メインフォントに同期 */
        .font-mono { font-family: var(--main-font); }

        .dynamic-text { color: var(--accent-color) !important; }
        .dynamic-bg { background-color: var(--accent-color) !important; }
        .dynamic-border { border-color: var(--accent-color) !important; }

        .editor-panel { background: #252525; border-radius: 4px; padding: 1.5rem; border: 1px solid #333; width: 100%; box-shadow: 0 4px 20px rgba(0,0,0,0.3); }

        input[type="text"], textarea, select {
            background-color: #1a1a1a; border: 1px solid #444; color: #fff;
            font-family: 'JetBrains Mono', monospace; font-size: 11px;
        }
        input[type="text"]:focus, textarea:focus, select:focus { border-color: var(--accent-color); outline: none; }

        .color-swatch-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px; }
        .color-dot { width: 100%; aspect-ratio: 1 / 1; border-radius: 2px; cursor: pointer; border: 1px solid #444; transition: all 0.2s; }
        .color-dot:hover { transform: scale(1.1); z-index: 10; border-color: #fff; }
        .color-dot.active { border: 2px solid #fff; box-shadow: 0 0 10px var(--accent-color); }
        .btn-dark { background-color: #111; border: 1px solid #444; color: #eee; transition: all 0.2s; }
        .btn-dark:hover { background-color: #222; border-color: var(--accent-color); color: var(--accent-color); }
        .btn-accent { background-color: var(--accent-color); color: #000; font-weight: 800; border: none; }
        .btn-accent:hover { filter: brightness(1.2); box-shadow: 0 0 15px var(--accent-color); }
        .loader { border: 2px solid #333; border-top: 2px solid var(--accent-color); border-radius: 50%; width: 14px; height: 14px; animation: spin 1s linear infinite; display: inline-block; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #exportStatus { position: fixed; bottom: 20px; background: #252525; color: var(--accent-color); padding: 8px 16px; border: 1px solid var(--accent-color); font-family: 'JetBrains Mono', monospace; font-size: 12px; display: none; z-index: 1000; }
        input[type="range"] { -webkit-appearance: none; width: 100%; height: 4px; background: #444; border-radius: 0; outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 10px; height: 10px; background: var(--accent-color); border-radius: 0; cursor: pointer; }
    </style>
</head>
<body>

    <div class="w-full max-w-3xl flex justify-between items-center mb-8 px-4 font-mono">
        <a href="index.html" class="text-xs font-bold text-gray-500 hover:text-gray-300 transition">&lt; MENU</a>
        <h1 class="text-xl font-bold text-gray-500 tracking-[0.5em] uppercase text-center">GENERATOR_<span class="dynamic-text">DARK</span></h1>
        <div class="w-16"></div>
    </div>

    <div class="tool-container space-y-4">
        <div class="bg-[#252525] p-3 border border-[#333] w-full">
            <label class="block text-[9px] font-bold text-gray-500 uppercase tracking-widest mb-2 font-mono">[FILE_SYSTEM]</label>
            <div class="grid grid-cols-2 gap-2">
                <button id="exportJsonBtn" class="btn-dark text-[10px] py-2 font-mono flex items-center justify-center gap-1"><span>▼ SAVE_JSON</span></button>
                <button id="importJsonBtn" class="btn-dark text-[10px] py-2 font-mono flex items-center justify-center gap-1"><span>▲ LOAD_JSON</span></button>
                <input type="file" id="jsonFileInput" accept=".json" class="hidden">
            </div>
        </div>

        <div id="captureArea">
            <div class="card" id="productCard">
                <div class="absolute top-6 right-6 w-16 h-1 dynamic-bg"></div>
                <div id="displayBgTextContainer" class="absolute flex items-end justify-end pointer-events-none select-none overflow-visible" 
                     style="bottom: -15%; right: -5%; width: 120%; height: 120%; opacity: 0.05; z-index: 0;">
                    <span id="displayBgText" class="text-[120pt] font-mono font-bold tracking-widest uppercase inline-block leading-none whitespace-nowrap text-white" 
                          style="padding: 0.5em; border: 2px solid white;">AF</span>
                </div>

                <div class="z-10 flex justify-between items-end mb-4 pt-2">
                    <div>
                        <p class="text-[7px] font-mono text-gray-500 mb-1 tracking-widest uppercase" id="displayCodeNameLabel">PRODUCT_ID</p>
                        <h1 class="text-3xl font-tech font-bold tracking-tight uppercase leading-none text-white">
                            <span id="displayBrandName">AroundForty</span><span class="dynamic-text">_</span>
                        </h1>
                    </div>
                    <div class="text-right">
                        <div class="flex items-center gap-2 justify-end mb-1">
                            <div class="w-2 h-2 rounded-full bg-gray-700"></div>
                            <div class="w-2 h-2 rounded-full dynamic-bg animate-pulse"></div>
                        </div>
                        <p class="text-[10px] font-mono text-gray-400 tracking-wider" id="displayCodeName">AroundFortyRB</p>
                    </div>
                </div>

                <div class="flex-grow flex flex-col justify-center relative z-10">
                    <div class="border-l-2 dynamic-border pl-3 py-1">
                        <p class="text-[6px] font-mono dynamic-text mb-1">SPECIFICATION_NOTE:</p>
                        <div id="displaySlogan" class="text-[8pt] font-mono text-gray-300 leading-tight break-words uppercase">DESIGNED FOR THE MATURE MIND. PRECISION ENGINEERED.</div>
                    </div>
                </div>

                <div class="z-10 flex justify-between items-end border-t border-gray-700 pt-2 mt-2">
                    <div class="flex flex-col gap-0.5">
                        <div class="flex gap-0.5 h-3 items-end opacity-70">
                            <div class="w-0.5 h-full bg-white"></div><div class="w-1 h-2/3 bg-white"></div><div class="w-0.5 h-full bg-white"></div>
                            <div class="w-2 h-full bg-white"></div><div class="w-0.5 h-1/2 bg-white"></div><div class="w-1 h-full bg-white"></div>
                        </div>
                        <span class="text-[5px] font-mono text-gray-500">894-39-AF</span>
                    </div>
                    <div class="flex flex-col text-right">
                        <span class="text-[5px] font-mono text-gray-500 tracking-widest mb-0.5 uppercase" id="displayMfgCodeLabel">MFG. CODE</span>
                        <span class="text-[10px] font-mono font-bold text-white tracking-widest bg-[#222] px-2 py-1 border border-[#444] inline-block whitespace-nowrap leading-none uppercase" id="displayMfgCode">02AFRB</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="editor-panel">
            <div class="flex justify-between items-center mb-6 border-b border-[#333] pb-4">
                <h2 class="text-xs font-mono font-bold text-gray-400 flex items-center gap-2">>> EDIT_PARAMETERS</h2>
            </div>
            
            <div class="space-y-5">
                <!-- Font Selection -->
                <div>
                    <label class="block text-[9px] font-bold text-gray-500 uppercase tracking-widest mb-2 font-mono">TYPEFACE</label>
                    <select id="fontSelect" class="w-full text-xs p-2 border border-[#444] bg-[#222] text-gray-300 font-mono h-8 cursor-pointer">
                        <option value="'JetBrains Mono', monospace">JETBRAINS MONO (CODE)</option>
                        <option value="'Rajdhani', sans-serif">RAJDHANI (TECH)</option>
                        <option value="'Oswald', sans-serif">OSWALD (BOLD)</option>
                        <option value="'Teko', sans-serif">TEKO (BLOCKY)</option>
                        <option value="'Share Tech Mono', monospace">SHARE TECH (RETRO)</option>
                        <option value="'Orbitron', sans-serif">ORBITRON (SCI-FI)</option>
                        <option value="'Chakra Petch', sans-serif">CHAKRA PETCH (MECHA)</option>
                    </select>
                </div>

                <div>
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-[9px] font-bold text-gray-500 uppercase tracking-widest font-mono">ACCENT_COLOR</label>
                        <span id="cmykValueDisplay" class="text-[8px] font-mono dynamic-text">NEON CYAN</span>
                    </div>
                    <div class="color-swatch-grid" id="swatchGrid"></div>
                </div>

                <div class="space-y-4">
                    <div>
                        <label class="block text-[9px] font-bold text-gray-500 uppercase tracking-widest mb-1 font-mono">BRAND_NAME</label>
                        <input type="text" id="brandNameInput" value="AroundForty" class="w-full text-xs p-2 font-mono">
                    </div>
                    <div>
                        <label class="block text-[9px] font-bold text-gray-500 uppercase tracking-widest mb-1 font-mono">DESCRIPTION</label>
                        <textarea id="sloganInput" class="w-full text-xs p-2 font-mono h-16 mb-2">DESIGNED FOR THE MATURE MIND. PRECISION ENGINEERED.</textarea>
                        <div class="flex justify-between items-center mb-1 px-1">
                            <label class="text-[7px] font-bold text-gray-500 uppercase tracking-widest font-mono">FONT_SIZE</label>
                            <span id="sloganSizeDisplay" class="text-[8px] font-mono dynamic-text">8pt</span>
                        </div>
                        <input type="range" id="sloganSizeInput" min="4" max="24" value="8" step="0.5" class="w-full">
                    </div>
                    <div class="p-3 bg-[#111] border border-[#333]">
                        <label class="block text-[9px] font-bold text-gray-500 uppercase tracking-widest mb-2 font-mono">BG_WATERMARK</label>
                        <input type="text" id="bgTextInput" value="AF" class="w-full text-xs p-2 font-mono mb-3 uppercase">
                        <div class="flex justify-between items-center mb-1">
                            <label class="text-[9px] font-bold text-gray-500 uppercase tracking-widest font-mono">SIZE</label>
                            <span id="bgTextSizeDisplay" class="text-[9px] font-mono dynamic-text">120pt</span>
                        </div>
                        <input type="range" id="bgTextSizeInput" min="40" max="250" value="120" class="w-full">
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-[8px] font-bold text-gray-600 uppercase tracking-widest mb-1 font-mono">LABEL_1</label>
                            <input type="text" id="codeNameLabelInput" value="PRODUCT_ID" class="w-full text-[10px] p-1 mb-1 font-mono bg-[#222] border-none text-gray-500 uppercase">
                            <input type="text" id="codeNameInput" value="AroundFortyRB" class="w-full text-xs p-2 font-mono">
                        </div>
                        <div>
                            <label class="block text-[8px] font-bold text-gray-600 uppercase tracking-widest mb-1 font-mono">LABEL_2</label>
                            <input type="text" id="mfgCodeLabelInput" value="MFG. CODE" class="w-full text-[10px] p-1 mb-1 font-mono bg-[#222] border-none text-gray-500 uppercase">
                            <input type="text" id="mfgCodeInput" value="02AFRB" class="w-full text-xs p-2 font-mono uppercase">
                        </div>
                    </div>
                </div>
            </div>

            <div class="pt-6 border-t border-[#333] mt-6">
                <button id="btnExport" class="w-full py-4 px-4 btn-accent text-xs tracking-widest flex items-center justify-center gap-2">
                    <span>[ GENERATE_PNG ]</span>
                </button>
            </div>
        </div>
    </div>

    <div id="exportStatus"></div>

    <script type="text/javascript">
        const techSwatches = [
            { hex: "#00E5FF", label: "NEON CYAN" }, { hex: "#FF0055", label: "HOT PINK" },
            { hex: "#FFE600", label: "CYBER YELLOW" }, { hex: "#00FF41", label: "MATRIX GREEN" },
            { hex: "#FF5722", label: "BLAZE ORANGE" }, { hex: "#7B00FF", label: "DEEP VIOLET" },
            { hex: "#FFFFFF", label: "PURE WHITE" }, { hex: "#444444", label: "STEALTH GREY" }
        ];

        const els = {
            card: document.getElementById('productCard'),
            brandName: document.getElementById('displayBrandName'),
            slogan: document.getElementById('displaySlogan'),
            bgText: document.getElementById('displayBgText'),
            bgTextContainer: document.getElementById('displayBgTextContainer'),
            codeNameLabel: document.getElementById('displayCodeNameLabel'),
            codeName: document.getElementById('displayCodeName'),
            mfgCodeLabel: document.getElementById('displayMfgCodeLabel'),
            mfgCode: document.getElementById('displayMfgCode'),
            brandNameInput: document.getElementById('brandNameInput'),
            sloganInput: document.getElementById('sloganInput'),
            sloganSizeInput: document.getElementById('sloganSizeInput'),
            sloganSizeDisplay: document.getElementById('sloganSizeDisplay'),
            bgTextInput: document.getElementById('bgTextInput'),
            bgTextSizeInput: document.getElementById('bgTextSizeInput'),
            bgTextSizeDisplay: document.getElementById('bgTextSizeDisplay'),
            codeNameLabelInput: document.getElementById('codeNameLabelInput'),
            codeNameInput: document.getElementById('codeNameInput'),
            mfgCodeLabelInput: document.getElementById('mfgCodeLabelInput'),
            mfgCodeInput: document.getElementById('mfgCodeInput'),
            btnExport: document.getElementById('btnExport'),
            status: document.getElementById('exportStatus'),
            exportJsonBtn: document.getElementById('exportJsonBtn'),
            importJsonBtn: document.getElementById('importJsonBtn'),
            jsonFileInput: document.getElementById('jsonFileInput'),
            cmykValueDisplay: document.getElementById('cmykValueDisplay'),
            swatchGrid: document.getElementById('swatchGrid'),
            fontSelect: document.getElementById('fontSelect')
        };

        const showStatus = (msg, duration = 3000) => {
            els.status.innerText = `>> ${msg}`;
            els.status.style.display = 'block';
            setTimeout(() => els.status.style.display = 'none', duration);
        };

        const syncUI = () => {
            if(els.brandName) els.brandName.innerText = els.brandNameInput.value;
            if(els.slogan) els.slogan.innerText = els.sloganInput.value;
            const sloganSize = els.sloganSizeInput.value;
            if(els.slogan) els.slogan.style.fontSize = `${sloganSize}pt`;
            if(els.sloganSizeDisplay) els.sloganSizeDisplay.innerText = `${sloganSize}pt`;
            if(els.bgText) els.bgText.innerText = els.bgTextInput.value;
            const bgSize = els.bgTextSizeInput.value;
            if(els.bgText) els.bgText.style.fontSize = `${bgSize}pt`;
            if(els.bgTextSizeDisplay) els.bgTextSizeDisplay.innerText = `${bgSize}pt`;
            if(els.codeNameLabel) els.codeNameLabel.innerText = els.codeNameLabelInput.value;
            if(els.codeName) els.codeName.innerText = els.codeNameInput.value;
            if(els.mfgCodeLabel) els.mfgCodeLabel.innerText = els.mfgCodeLabelInput.value;
            if(els.mfgCode) els.mfgCode.innerText = els.mfgCodeInput.value.toUpperCase();
        };

        els.fontSelect.onchange = (e) => {
            document.documentElement.style.setProperty('--main-font', e.target.value);
        };

        [els.brandNameInput, els.sloganInput, els.sloganSizeInput, els.bgTextInput, els.bgTextSizeInput, 
         els.codeNameLabelInput, els.codeNameInput, els.mfgCodeLabelInput, els.mfgCodeInput].forEach(el => {
            if(el) el.addEventListener('input', syncUI);
        });

        let currentAccentColor = "#00E5FF";
        const updateThemeColor = (hex, label = "CUSTOM") => {
            currentAccentColor = hex;
            document.documentElement.style.setProperty('--accent-color', hex);
            els.cmykValueDisplay.innerText = label;
            document.querySelectorAll('.color-dot').forEach(dot => {
                dot.classList.toggle('active', dot.dataset.hex === hex);
            });
        };

        const initSwatches = () => {
            els.swatchGrid.innerHTML = "";
            techSwatches.forEach(swatch => {
                const dot = document.createElement('div');
                dot.className = 'color-dot';
                dot.style.backgroundColor = swatch.hex;
                dot.dataset.hex = swatch.hex;
                dot.title = swatch.label;
                dot.onclick = () => updateThemeColor(swatch.hex, swatch.label);
                if (swatch.hex.toLowerCase() === currentAccentColor.toLowerCase()) { dot.classList.add('active'); }
                els.swatchGrid.appendChild(dot);
            });
        };

        function getFileName(extension) {
            const base = els.codeNameInput.value.trim() || "DarkCard";
            const now = new Date();
            const timestamp = now.toISOString().replace(/[:.]/g, '-').slice(0, 19);
            return `DARK_${base}_${timestamp}.${extension}`;
        }

        els.exportJsonBtn.onclick = () => {
            const data = {
                brandName: els.brandNameInput.value, slogan: els.sloganInput.value, sloganSize: els.sloganSizeInput.value,
                bgText: els.bgTextInput.value, bgTextSize: els.bgTextSizeInput.value,
                codeNameLabel: els.codeNameLabelInput.value, codeName: els.codeNameInput.value,
                mfgCodeLabel: els.mfgCodeLabelInput.value, mfgCode: els.mfgCodeInput.value,
                font: els.fontSelect.value,
                accentColor: currentAccentColor, colorLabel: els.cmykValueDisplay.innerText, exportedAt: new Date().toISOString()
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type : 'application/json'});
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = getFileName('json');
            link.click();
            URL.revokeObjectURL(url);
            showStatus("CONFIG SAVED");
        };

        els.importJsonBtn.onclick = () => els.jsonFileInput.click();
        els.jsonFileInput.onchange = (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (event) => {
                try {
                    const data = JSON.parse(event.target.result);
                    applyData(data);
                    showStatus("CONFIG LOADED");
                } catch (err) { showStatus("LOAD FAILED"); }
            };
            reader.readAsText(file);
            e.target.value = '';
        };

        function applyData(data) {
            if (data.brandName) els.brandNameInput.value = data.brandName;
            if (data.slogan) els.sloganInput.value = data.slogan;
            if (data.sloganSize) {
                els.sloganSizeInput.value = data.sloganSize;
                els.sloganSizeDisplay.innerText = data.sloganSize + "pt";
            }
            if (data.bgText) els.bgTextInput.value = data.bgText;
            if (data.bgTextSize) {
                els.bgTextSizeInput.value = data.bgTextSize;
                els.bgTextSizeDisplay.innerText = data.bgTextSize + "pt";
            }
            if (data.codeNameLabel) els.codeNameLabelInput.value = data.codeNameLabel;
            if (data.codeName) els.codeNameInput.value = data.codeName;
            if (data.mfgCodeLabel) els.mfgCodeLabelInput.value = data.mfgCodeLabel;
            if (data.mfgCode) els.mfgCodeInput.value = data.mfgCode;
            if (data.font) {
                els.fontSelect.value = data.font;
                document.documentElement.style.setProperty('--main-font', data.font);
            }
            if (data.accentColor) updateThemeColor(data.accentColor, data.colorLabel || "CUSTOM");
            
            syncUI();
        }

        els.btnExport.onclick = async () => {
            if (typeof html2canvas === 'undefined') return showStatus("INITIALIZING LIB...");
            els.btnExport.disabled = true;
            const originalText = els.btnExport.innerHTML;
            els.btnExport.innerHTML = '<span class="loader"></span> PROCESSING...';

            try {
                if (document.fonts && document.fonts.ready) { await document.fonts.ready; }
                const cardRect = els.card.getBoundingClientRect();
                const options = {
                    scale: 3, useCORS: true, backgroundColor: "#0F0F11",
                    width: cardRect.width, height: cardRect.height, scrollX: 0, scrollY: -window.scrollY,
                    onclone: (clonedDoc) => {
                        const c = clonedDoc.getElementById('productCard');
                        const bgContainer = clonedDoc.getElementById('displayBgTextContainer');
                        const bgText = clonedDoc.getElementById('displayBgText');
                        if (c) {
                            c.style.boxShadow = 'none'; c.style.transform = 'none'; c.style.overflow = 'visible';
                        }
                        if (bgContainer && bgText) {
                            bgContainer.style.width = '200%'; bgContainer.style.height = '200%';
                            bgContainer.style.bottom = '-15%'; bgContainer.style.right = '-5%';
                            bgText.style.display = 'inline-block'; bgText.style.lineHeight = '1.2';
                            bgText.style.padding = '1em'; bgText.style.margin = '0';
                        }
                    }
                };
                const canvas = await html2canvas(els.card, options);
                const dataUrl = canvas.toDataURL('image/png', 1.0);
                const link = document.createElement('a');
                link.download = getFileName('png');
                link.href = dataUrl;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                showStatus("EXPORT COMPLETE");
            } catch (err) {
                console.error("Export failed:", err);
                showStatus("EXPORT FAILED");
            } finally {
                els.btnExport.disabled = false;
                els.btnExport.innerHTML = originalText;
            }
        };

        initSwatches();
        syncUI();
    </script>
</body>
</html>
